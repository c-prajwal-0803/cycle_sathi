<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cycleâ€¯Sathiâ€¯Web</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#ffe6f0 0%,#f7ecff 100%);min-height:100vh;color:#333;}
  .screen{display:none;} .active{display:block;}
  h2,h3,h5{color:#630A60;}
  .card-box{background:#fff;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.1);padding:30px;margin:20px auto;}
  .btn-primary{background-color:#e75480;border:none;} .btn-primary:hover{background-color:#d44672;}
  .btn-success{background:#8ac926;border:none;} .btn-success:hover{background:#75b61e;}
  .navbar{background:linear-gradient(90deg,#e75480,#bc6ff1);}
  .navbar-brand{font-weight:600;letter-spacing:0.5px;}
  .navbar .nav-link{color:white!important;font-weight:500;padding:8px 16px;}
  .navbar .nav-link:hover{background:rgba(255,255,255,0.2);border-radius:5px;}
  label{font-weight:500;}
  input[type="date"],.form-control,.form-select,textarea{border-radius:10px;border:1px solid #ddd;}
  #screen1{text-align:center;padding-top:10vh;}
  #screen1 img{width:180px;border-radius:50%;border:4px solid #fff;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
  .section{display:none;} .active-section{display:block;}
  #records table th,#records table td{vertical-align:top;font-size:0.9rem;}
  #records table thead th{color:#630A60;font-weight:600;}
  #learn input,#learn textarea{background:#fff8fb;}
  #listenBtn{background-color:#bc6ff1;color:#fff;border:none;}#listenBtn:hover{background-color:#a655db;}
</style>
</head>
<body>

<!-- ===== SPLASH ===== -->
<div id="screen1" class="screen active text-center">
  <img src="https://via.placeholder.com/180/ffe6f0/630A60?text=Cycle+Sathi" alt="logo" class="mb-4">
  <h2>Cycleâ€¯Sathi</h2>
  <p class="text-muted">Understand, track, and care for your cycle!</p>
  <button class="btn btn-primary mt-3 px-4 py-2" onclick="showScreen('screen2')">Getâ€¯Started</button>
</div>

<!-- ===== LOGIN ===== -->
<div id="screen2" class="screen container py-5">
  <div class="card-box col-md-6">
    <h3 class="text-center mb-4">Login</h3>
    <div class="mb-3"><label>Emailâ€¯/â€¯Username</label><input id="loginEmail" class="form-control"></div>
    <div class="mb-3"><label>Password</label><input id="loginPass" type="password" class="form-control"></div>
    <button class="btn btn-success w-100 mt-2" onclick="loginUser()">Login</button>
    <p class="mt-3 text-center">Newâ€¯user?â€¯<a href="#" onclick="showScreen('screen4')">Signâ€¯Up</a></p>
  </div>
</div>

<!-- ===== SIGNUP ===== -->
<div id="screen4" class="screen container py-5">
  <div class="card-box col-md-6">
    <h3 class="text-center mb-4">Createâ€¯Account</h3>
    <div class="mb-3"><label>Emailâ€¯/â€¯Username</label><input id="signEmail" class="form-control"></div>
    <div class="mb-3"><label>Password</label><input id="signPass" type="password" class="form-control"></div>
    <div class="mb-3"><label>Confirmâ€¯Password</label><input id="signConf" type="password" class="form-control"></div>
    <button class="btn btn-primary w-100" onclick="registerUser()">Signâ€¯Up</button>
    <button class="btn btn-link w-100 mt-2" onclick="showScreen('screen2')">Backâ€¯toâ€¯Login</button>
  </div>
</div>

<!-- ===== HOME ===== -->
<div id="home" class="screen">
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <a class="navbar-brand">ðŸŒ¸â€¯Cycleâ€¯Sathi</a>
    <div class="navbar-nav ms-auto">
      <a class="nav-link" href="#" onclick="showSection('profile')">Profile</a>
      <a class="nav-link" href="#" onclick="showSection('track')">Track</a>
      <a class="nav-link" href="#" onclick="showSection('learn')">Learn</a>
      <a class="nav-link" href="#" onclick="showSection('records')">Records</a>
      <a class="nav-link" href="#" onclick="logout()">Logout</a>
    </div>
  </div>
</nav>

<div class="container py-4">

<!-- ==== PROFILE ==== -->
<section id="profile" class="section active-section">
  <div class="card-box">
    <h3>Profile</h3><hr>
    <div class="row g-3">
      <div class="col-md-6"><label>Name</label><input id="name" class="form-control"></div>
      <div class="col-md-3"><label>Age</label><input id="age" type="number" class="form-control"></div>
      <div class="col-md-3"><label>Cycleâ€¯Lengthâ€¯(days)</label><input id="cycleLen" type="number" class="form-control"></div>
      <div class="col-md-6"><label>Allergies</label><input id="allergies" class="form-control"></div>
      <div class="col-md-6"><label>Medicalâ€¯Conditions</label><input id="conditions" class="form-control"></div>
      <div class="col-md-12"><label>Notes</label><textarea id="notes" class="form-control" rows="2"></textarea></div>
    </div>
    <h5 class="mt-4">Vitalsâ€¯(fromâ€¯ESP8266)</h5>
    <div class="row g-3">
      <div class="col-md-3"><label>Heartâ€¯Rateâ€¯(BPM)</label><input id="heart" class="form-control" readonly></div>
      <div class="col-md-3"><label>Oâ‚‚â€¯(%)</label><input id="o2" class="form-control" readonly></div>
      <div class="col-md-3"><label>Movement</label><input id="moves" class="form-control" readonly></div>
      <div class="col-md-3"><label>Temperatureâ€¯(Â°C)</label><input id="temp" class="form-control" readonly></div>
    </div>
    <button class="btn btn-success mt-3 px-4" onclick="saveProfile()">Saveâ€¯Profile</button>
  </div>
</section>

<!-- ==== TRACK ==== -->
<section id="track" class="section">
  <div class="card-box">
    <h3>Trackâ€¯Yourâ€¯Cycle</h3><hr>
    <div class="row g-3">
      <div class="col-md-6"><label>Startâ€¯Date</label><input type="date" id="startDate" class="form-control"></div>
      <div class="col-md-6"><label>Endâ€¯Date</label><input type="date" id="endDate" class="form-control"></div>
    </div>
    <h5 class="mt-4">Symptoms</h5>
    <div class="row g-3">
      <div class="col-md-6"><label>Flowâ€¯Level</label>
        <select id="flow" class="form-select"><option>Light</option><option>Moderate</option><option>Heavy</option></select>
      </div>
      <div class="col-md-6"><label>Painâ€¯Level</label><input type="range" id="pain" min="0" max="10" class="form-range"></div>
    </div>
    <button class="btn btn-primary mt-3 px-4" onclick="saveSymptoms()">Saveâ€¯&â€¯Predict</button>
    <h5 class="mt-4">Predictions</h5>
    <div class="row g-3">
      <div class="col-md-4"><label>Nextâ€¯Period</label><input class="form-control" id="nextPeriod" readonly></div>
      <div class="col-md-4"><label>Ovulation</label><input class="form-control" id="ovulation" readonly></div>
      <div class="col-md-4"><label>Fertileâ€¯Window</label><input class="form-control" id="fertile" readonly></div>
    </div>
  </div>
</section>

<!-- ==== LEARN ==== -->
<section id="learn" class="section">
  <div class="card-box">
    <h3>Learn & Ask</h3>
    <p class="text-muted">Ask menstrual health, symptoms, or dietâ€‘related questions and get AI guidance.</p>
    <div class="mb-3">
      <label class="fw-semibold">Your question:</label>
      <input id="question" class="form-control" placeholder="e.g. What foods help reduce cramps?">
    </div>
    <button class="btn btn-primary mb-3" onclick="askQuestion()">Ask</button>
    <div>
      <label class="fw-semibold">Answer:</label>
      <textarea id="answer" class="form-control" rows="5" readonly placeholder="Your answer will appear here..."></textarea>
    </div>
    <button id="listenBtn" class="btn mt-3" onclick="speakAnswer()">ðŸ”ŠÂ Listen to answer</button>
  </div>
</section>

<!-- ==== RECORDS ==== -->
<section id="records" class="section">
  <div class="card-box">
    <h3>Records History</h3>
    <p class="text-muted">Complete saved history from both Cycle and Profile sections.</p>
    <div style="max-height:450px;overflow-y:auto;border:1px solid #e5d1f7;border-radius:10px;">
      <table class="table table-striped align-middle mb-0">
        <thead style="background:#f4e7fb;position:sticky;top:0;">
          <tr><th>Timestamp</th><th>Category</th><th>Data</th></tr>
        </thead>
        <tbody id="recordsTableBody">
          <tr><td colspan="3" class="text-center text-muted">No records yet</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

</div>
</div>

<script>
/* ==================== AUTH ==================== */
function showScreen(id){document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));document.getElementById(id).classList.add("active");}
function registerUser(){const e=signEmail.value.trim(),p=signPass.value,c=signConf.value;if(!e||!p){alert("Fill all fields");return;}if(p!==c){alert("Passwords do not match");return;}localStorage.setItem("userEmail",e);localStorage.setItem("userPass",p);alert("Signâ€‘Up successful! Please login.");showScreen("screen2");}
function loginUser(){const e=loginEmail.value.trim(),p=loginPass.value;const se=localStorage.getItem("userEmail"),sp=localStorage.getItem("userPass");if(e===se&&p===sp){alert("Login successful!");localStorage.setItem("currentUser",e);showScreen("home");loadUserData(e);}else{alert("Invalid credentials. Try again or SignÂ up.");}}
function logout(){alert("Logged out successfully!");showScreen("screen2");localStorage.removeItem("currentUser");}

/* ==================== NAV ==================== */
function showSection(id){document.querySelectorAll(".section").forEach(s=>s.classList.remove("active-section"));document.getElementById(id).classList.add("active-section");}

/* ==================== PROFILE ==================== */
function saveProfile(){const email=localStorage.getItem("currentUser");if(!email){alert("Login first.");return;}const prefix=email+"_";["name","age","cycleLen","allergies","conditions","notes"].forEach(id=>localStorage.setItem(prefix+id,document.getElementById(id).value));alert("Profile saved!");addRecord("profile",{Name:name.value,Age:age.value,Cycle_Length:cycleLen.value,Allergies:allergies.value,Conditions:conditions.value,Notes:notes.value,Heart_Rate:heart.value||"",O2:o2.value||"",Movement:moves.value||"",Temperature:temp.value||""});}

/* ==================== TRACK ==================== */
function saveSymptoms(){const email=localStorage.getItem("currentUser");if(!email){alert("Login first.");return;}const prefix=email+"_";const start=startDate.value;if(!start){alert("Select Start Date");return;}const sDate=new Date(start);const addDays=d=>new Date(sDate.getTime()+d*86400000).toLocaleDateString();nextPeriod.value=addDays(28);ovulation.value=addDays(14);fertile.value=`${addDays(10)} to ${addDays(15)}`;localStorage.setItem(prefix+"startDate",start);localStorage.setItem(prefix+"endDate",endDate.value);localStorage.setItem(prefix+"flow",flow.value);localStorage.setItem(prefix+"pain",pain.value);alert("Symptoms saved!");addRecord("track",{Name:name.value||localStorage.getItem(prefix+"name")||"(no name)",Start_Date:startDate.value,End_Date:endDate.value,Flow:flow.value,Pain_Level:pain.value,Next_Period:nextPeriod.value,Ovulation:ovulation.value,Fertile_Window:fertile.value});}

/* ==================== RECORDS ==================== */
function addRecord(type,dataObj){const email=localStorage.getItem("currentUser");if(!email)return;const prefix=email+"_";const storedName=localStorage.getItem(prefix+"name")||"(not set)";if(!dataObj.Name)dataObj.Name=storedName;const timestamp=new Date().toLocaleString();const recs=JSON.parse(localStorage.getItem(prefix+"records")||"[]");recs.push({type,data:dataObj,time:timestamp});localStorage.setItem(prefix+"records",JSON.stringify(recs));loadRecords(email);}
function loadRecords(email){const tbody=document.getElementById("recordsTableBody");if(!tbody)return;const prefix=email+"_";const records=JSON.parse(localStorage.getItem(prefix+"records")||"[]").reverse();if(!records.length){tbody.innerHTML=`<tr><td colspan="3" class="text-center text-muted">No records yet</td></tr>`;return;}tbody.innerHTML=records.map(r=>{const entries=Object.entries(r.data);const nameEntry=entries.find(([k])=>k==="Name");const other=entries.filter(([k])=>k!=="Name");const details=(nameEntry?`<div><strong>${nameEntry[0]}</strong>: ${nameEntry[1]||"-"}</div>`:"")+other.map(([k,v])=>`<div><strong>${k}</strong>: ${v||"-"}</div>`).join("");return`<tr><td>${r.time}</td><td>${r.type==="track"?"CycleÂ Tracking":"Profile"}</td><td>${details}</td></tr>`;}).join("");}

/* ==================== LEARNÂ withÂ GEMINI ==================== */
async function askQuestion(){
  const q=question.value.trim();const ansBox=answer;
  if(!q){alert("Please enter a question about menstrual cycle or diet.");return;}
  ansBox.value="Thinking...";
  try{
    const GEMINI_KEY="AIzaSyApR29apHfoAMu2jJnL3bBb6GgcZvWy4Dg"; // ðŸ”¹ paste your new API key here
    const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_KEY}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        contents:[{parts:[{text:`You are Cycleâ€¯Sathi, a friendly assistant providing factual menstrual health, nutrition, and wellness advice.\nQuestion: ${q}` }]}]
      })
    });
    const data=await response.json();
    const text=data.candidates?.[0]?.content?.parts?.[0]?.text||"Sorry, I couldn't find an answer right now.";
    ansBox.value=text;
  }catch(err){console.error(err);ansBox.value="Error reaching GeminiÂ API. Please try again later.";}
}
function speakAnswer(){const text=answer.value;if(!text){alert("No answer to read.");return;}const utter=new SpeechSynthesisUtterance(text);utter.rate=1;utter.pitch=1;speechSynthesis.speak(utter);}

/* ==================== LOAD USER DATA ==================== */
function loadUserData(email){const prefix=email+"_";["name","age","cycleLen","allergies","conditions","notes"].forEach(id=>{const v=localStorage.getItem(prefix+id);if(v)document.getElementById(id).value=v;});loadRecords(email);}
</script>
</body>
</html>